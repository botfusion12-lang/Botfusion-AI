<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BotFusion AI</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
/* RESET */
* { margin:0; padding:0; box-sizing:border-box; font-family:'Inter', sans-serif; }
body { display:flex; height:100vh; background:#121212; color:#f1f1f1; overflow:hidden; }

/* SIDEBAR */
.sidebar { width:280px; background:#1f1f1f; display:flex; flex-direction:column; border-right:1px solid #2a2a2a; }
.sidebar .logo { padding:20px; font-size:22px; font-weight:700; text-align:center; background:linear-gradient(90deg,#7C4DFF,#BB86FC); -webkit-background-clip:text; color:transparent; }
.sidebar .menu { flex:1; overflow-y:auto; margin-top:10px; }
.menu-item { padding:14px 20px; display:flex; align-items:center; gap:12px; cursor:pointer; border-radius:8px; transition:0.2s; }
.menu-item:hover { background:#2a2a2a; }
.menu-item i { font-size:18px; }

/* BOTTOM MENU */
.bottom-menu { border-top:1px solid #2a2a2a; padding:10px; display:flex; flex-direction:column; gap:8px; }
.bottom-menu button { padding:10px; border:none; border-radius:8px; cursor:pointer; background:#2b2b2b; color:white; transition:0.2s; }
.bottom-menu button:hover { background:#3a3a3a; }

/* MAIN AREA */
.main { flex:1; display:flex; flex-direction:column; background:#181818; }
.top-bar { height:60px; display:flex; align-items:center; justify-content:space-between; padding:0 20px; border-bottom:1px solid #2a2a2a; }
.top-bar select { background:#2b2b2b; border:none; border-radius:6px; padding:6px 12px; color:white; cursor:pointer; }

/* CHAT AREA */
.chat-container { flex:1; overflow-y:auto; padding:20px; display:flex; flex-direction:column; gap:12px; }
.message { max-width:70%; padding:14px 18px; border-radius:12px; line-height:1.4; position:relative; word-wrap:break-word; }
.user { align-self:flex-end; background:#3b3b3b; }
.bot { align-self:flex-start; background:#262626; border:1px solid #2a2a2a; }
.message span.time { position:absolute; bottom:-16px; right:10px; font-size:10px; color:#999; }

/* IMAGE AREA */
.image-area { display:grid; grid-template-columns:repeat(auto-fill,minmax(120px,1fr)); gap:12px; padding:12px; }
.generated-image { width:100%; height:120px; object-fit:cover; border-radius:8px; transition:0.2s; }
.generated-image:hover { transform:scale(1.05); }

/* INPUT AREA */
.input-area { display:flex; gap:10px; padding:12px 20px; border-top:1px solid #2a2a2a; }
.input-area input { flex:1; padding:12px 16px; border-radius:10px; border:none; background:#2b2b2b; color:white; }
.input-area button { padding:0 16px; border:none; border-radius:10px; background:#7C4DFF; color:white; cursor:pointer; transition:0.2s; }
.input-area button:hover { background:#BB86FC; }
</style>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "botfusion-ai.firebaseapp.com",
  projectId: "botfusion-ai",
  storageBucket: "botfusion-ai.appspot.com",
  messagingSenderId: "XXXX",
  appId: "XXXX"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();
const db = getFirestore(app);

window.auth = auth;
window.provider = provider;
window.db = db;
window.doc = doc;
window.setDoc = setDoc;
window.getDoc = getDoc;
window.updateDoc = updateDoc;
window.arrayUnion = arrayUnion;
window.signInWithPopup = signInWithPopup;
window.signOutFirebase = signOut;
window.onAuthStateChanged = onAuthStateChanged;
</script>

</head>
<body>

<div class="sidebar">
  <div class="logo">ü§ñ BotFusion AI</div>
  <div class="menu">
    <div class="menu-item" onclick="newChat()"><i class="fa-solid fa-plus"></i> New Chat</div>
    <div class="menu-item" onclick="toggleHistory()"><i class="fa-solid fa-clock-rotate-left"></i> History</div>
    <div class="menu-item" onclick="toggleSettings()"><i class="fa-solid fa-gear"></i> Settings</div>
    <div class="menu-item" onclick="toggleProfile()"><i class="fa-solid fa-user"></i> Account</div>
  </div>
  <div class="bottom-menu">
    <button onclick="googleLogin()">üîê Sign in with Google</button>
    <button onclick="logout()">üö™ Logout</button>
  </div>
</div>

<div class="main">
  <div class="top-bar">
    <div>Chat</div>
   <select name="language" id="language">
  <option>Auto Detect</option>
  <option value="af">Afrikaans</option>
  <option value="sq">Albanian</option>
  <option value="am">Amharic</option>
  <option value="ar">Arabic</option>
  <option value="hy">Armenian</option>
  <option value="az">Azerbaijani</option>
  <option value="eu">Basque</option>
  <option value="be">Belarusian</option>
  <option value="bn">Bengali</option>
  <option value="bs">Bosnian</option>
  <option value="bg">Bulgarian</option>
  <option value="my">Burmese</option>
  <option value="ca">Catalan</option>
  <option value="ceb">Cebuano</option>
  <option value="zh">Chinese</option>
  <option value="co">Corsican</option>
  <option value="hr">Croatian</option>
  <option value="cs">Czech</option>
  <option value="da">Danish</option>
  <option value="nl">Dutch</option>
  <option value="en">English</option>
  <option value="eo">Esperanto</option>
  <option value="et">Estonian</option>
  <option value="fi">Finnish</option>
  <option value="fr">French</option>
  <option value="fy">Frisian</option>
  <option value="gl">Galician</option>
  <option value="ka">Georgian</option>
  <option value="de">German</option>
  <option value="el">Greek</option>
  <option value="gu">Gujarati</option>
  <option value="ht">Haitian Creole</option>
  <option value="ha">Hausa</option>
  <option value="haw">Hawaiian</option>
  <option value="he">Hebrew</option>
  <option value="hi">Hindi</option>
  <option value="hmn">Hmong</option>
  <option value="hu">Hungarian</option>
  <option value="is">Icelandic</option>
  <option value="ig">Igbo</option>
  <option value="id">Indonesian</option>
  <option value="ga">Irish</option>
  <option value="it">Italian</option>
  <option value="ja">Japanese</option>
  <option value="jw">Javanese</option>
  <option value="kn">Kannada</option>
  <option value="kk">Kazakh</option>
  <option value="km">Khmer</option>
  <option value="ko">Korean</option>
  <option value="ku">Kurdish</option>
  <option value="ky">Kyrgyz</option>
  <option value="lo">Lao</option>
  <option value="la">Latin</option>
  <option value="lv">Latvian</option>
  <option value="lt">Lithuanian</option>
  <option value="lb">Luxembourgish</option>
  <option value="mk">Macedonian</option>
  <option value="mg">Malagasy</option>
  <option value="ms">Malay</option>
  <option value="ml">Malayalam</option>
  <option value="mt">Maltese</option>
  <option value="mi">Maori</option>
  <option value="mr">Marathi</option>
  <option value="mn">Mongolian</option>
  <option value="ne">Nepali</option>
  <option value="no">Norwegian</option>
  <option value="or">Odia</option>
  <option value="ps">Pashto</option>
  <option value="fa">Persian</option>
  <option value="pl">Polish</option>
  <option value="pt">Portuguese</option>
  <option value="pa">Punjabi</option>
  <option value="ro">Romanian</option>
  <option value="ru">Russian</option>
  <option value="sm">Samoan</option>
  <option value="gd">Scots Gaelic</option>
  <option value="sr">Serbian</option>
  <option value="st">Sesotho</option>
  <option value="sn">Shona</option>
  <option value="sd">Sindhi</option>
  <option value="si">Sinhala</option>
  <option value="sk">Slovak</option>
  <option value="sl">Slovenian</option>
  <option value="so">Somali</option>
  <option value="es">Spanish</option>
  <option value="su">Sundanese</option>
  <option value="sw">Swahili</option>
  <option value="sv">Swedish</option>
  <option value="tl">Tagalog</option>
  <option value="ta">Tamil</option>
  <option value="te">Telugu</option>
  <option value="th">Thai</option>
  <option value="tr">Turkish</option>
  <option value="uk">Ukrainian</option>
  <option value="ur">Urdu</option>
  <option value="uz">Uzbek</option>
  <option value="vi">Vietnamese</option>
  <option value="cy">Welsh</option>
  <option value="xh">Xhosa</option>
  <option value="yi">Yiddish</option>
  <option value="yo">Yoruba</option>
  <option value="zu">Zulu</option>
   </select>
  </div>

  <div class="chat-container" id="chat"></div>
  <div class="image-area" id="images"></div>

  <div class="input-area">
    <input id="input" placeholder="Type a message..."/>
    <button onclick="sendMessage()">Send</button>
    <button onclick="generateImage()"> Generate Image</button>
  </div>
</div>

<!-- Font Awesome for Icons -->
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

<script type="module">
// CHAT, IMAGE, FIREBASE FUNCTIONS
const chat = document.getElementById("chat");
const input = document.getElementById("input");
const imageDiv = document.getElementById("images");
let currentUser=null;
let chats=[], currentChat=null;

// ------------------- LOGIN -------------------
window.googleLogin=async function(){
  try{
    const result=await signInWithPopup(auth, provider);
    currentUser=result.user;
    alert("Welcome "+currentUser.displayName);
    const userRef=doc(db,"users",currentUser.uid);
    const snap=await getDoc(userRef);
    if(!snap.exists()){
      await setDoc(userRef,{name:currentUser.displayName,email:currentUser.email,photo:currentUser.photoURL,createdAt:new Date()});
    }
  }catch(err){console.error(err);alert("Login failed");}
};

window.logout=async function(){await signOutFirebase(auth);currentUser=null;chats=[];chat.innerHTML="";imageDiv.innerHTML="";alert("Logged out");};

onAuthStateChanged(auth,user=>{if(user)currentUser=user;});

// ------------------- CHAT -------------------
function addMessage(text,sender){
  const div=document.createElement("div");
  div.className="message "+sender;
  div.innerHTML=text+` <span class="time">${new Date().toLocaleTimeString()}</span>`;
  chat.appendChild(div);
  chat.scrollTop=chat.scrollHeight;
}
function newChat(){currentChat={id:Date.now(),messages:[]};chats.push(currentChat);chat.innerHTML="";}
async function sendMessage(){
  if(!currentUser){alert("Please login");return;}
  const text=input.value.trim();
  if(!text)return;
  addMessage(text,"user");
  currentChat.messages.push({text,sender:"user"});
  input.value="";
  try{
    const res=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:text,userId:currentUser.uid,language:document.getElementById("lang").value})});
    const data=await res.json();
    addMessage(data.reply,"bot");
    currentChat.messages.push({text:data.reply,sender:"bot"});
  }catch(err){console.error(err);addMessage("‚ö†Ô∏è Server error","bot");}
}

// ------------------- IMAGE -------------------
async function generateImage(){
  if(!currentUser){alert("Please login");return;}
  const prompt=window.prompt("Enter image description:");
  if(!prompt)return;
  try{
    const res=await fetch("/api/image",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt,userId:currentUser.uid})});
    const data=await res.json();
    if(data.url){const img=document.createElement("img");img.src=data.url;img.className="generated-image";imageDiv.appendChild(img);}
  }catch(err){console.error(err);alert("Error generating image");}
}
newChat();
</script>
</body>
</html>
